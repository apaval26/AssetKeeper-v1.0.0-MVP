{% extends 'main.html' %}

{% block contentTitle %}
<title>Contact Us</title>
{% endblock contentTitle %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="/static/AppOneSDG/contact-us.css">
<link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
<style>
    .field-error {
        color: red;
        font-size: 14px;
        margin-top: 5px;
        font-weight: bold;
    }
</style>
{% endblock extra_css %}

{% block contentBody %}

<div class="wrapper">
    <div class="overlay">
        <div class="text">
            <h1 id="intro" style="color:white;">Contact Us</h1>
        </div>
    </div>
</div>

<br><br>

<h1 class="title" style="color: var(--text-primary); padding-bottom:60px; font-size:40px;">
    Contact UOW Technical Team
</h1>

<p style="margin:50px; margin-top:30px; margin-left:370px; font-family:'Montserrat'; color: var(--text-primary); width:100%;">
    Please fill out the form and a member from the IT department will get back to you as soon as possible.
</p>

<div class="container">

<form id="contactForm" method="POST" action="{% url 'contact_submit' %}" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="contact-box">

        <!-- LEFT SIDE FORM -->
        <div class="contact-left">
            <h3>Send your request</h3>

            <div class="input-row">
                <div class="input-group">
                    <label>First Name</label>
                    <input type="text" name="firstName" placeholder="Please enter your first name">
                    <p class="field-error" id="error-firstName"></p>
                </div>

                <div class="input-group">
                    <label>Last Name</label>
                    <input type="text" name="lastName" placeholder="Please enter your last name">
                    <p class="field-error" id="error-lastName"></p>
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="text" name="emailAddress" placeholder="Please enter your email address">
                    <p class="field-error" id="error-emailAddress"></p>
                </div>

                <div class="input-group">
                    <label>Telephone Number</label>
                    <input type="text" name="telephoneNumber" placeholder="Please enter your tel number">
                    <p class="field-error" id="error-telephoneNumber"></p>
                </div>
            </div>

            <div class="input-group">
                <label>Issue Type</label>
                <select name="issueType">
                    <option value="">Please select an issue type</option>
                    <option value="Faulty Item">Faulty Item</option>
                    <option value="Damaged Item">Damaged Item</option>
                    <option value="Missing Item">Missing Item</option>
                    <option value="Other">Other</option>
                </select>
                <p class="field-error" id="error-issueType"></p>
            </div>

            <div class="input-group">
                <label>Upload Evidence (optional)</label>
                <input type="file" name="evidenceFile" accept="image/*,application/pdf">
                <p class="field-error" id="error-evidenceFile"></p>
            </div>

            <label>Message</label>
            <textarea rows="5" name="message" placeholder="How can we help you?"></textarea>
            <p class="field-error" id="error-message"></p>

            <button type="submit" id="button" style="background:#E29427">Send Message</button>
        </div>

        <!-- RIGHT SIDE INFO -->
        <div class="contact-right">
            <h3>Reach Us</h3>
            <br>

            <table id="contactTable"> <tr> <td>Support Email:</td> <td>support@assetkeeper.io</td> </tr> <tr> <td>Telephone Number:</td> <td>+44 20 1234 5678</td> </tr> <tr> <td>Helpdesk Ticket:</td> <td> <a href="#" style="text-decoration:underline;"> Submit a Support Ticket </a> </td> </tr> <tr> <td>Office Address:</td> <td>Asset Keeper HQ, London, United Kingdom</td> </tr> </table>
        </div>

    </div> <!-- END contact-box -->

</form>

</div> <!-- END container -->

{% endblock contentBody %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {

    const form = document.getElementById("contactForm");

    const firstName = document.querySelector("input[name='firstName']");
    const lastName = document.querySelector("input[name='lastName']");
    const email = document.querySelector("input[name='emailAddress']");
    const phone = document.querySelector("input[name='telephoneNumber']");
    const issueType = document.querySelector("select[name='issueType']");
    const evidenceFile = document.querySelector("input[name='evidenceFile']");
    const message = document.querySelector("textarea[name='message']");

    function setError(id, msg) {
        document.getElementById(id).textContent = msg;
    }

    function clearError(id) {
        document.getElementById(id).textContent = "";
    }

    // LIVE VALIDATION
    firstName.addEventListener("input", () => {
        firstName.value.trim()
            ? clearError("error-firstName")
            : setError("error-firstName", "First name is required.");
    });

    lastName.addEventListener("input", () => {
        lastName.value.trim()
            ? clearError("error-lastName")
            : setError("error-lastName", "Last name is required.");
    });

    email.addEventListener("input", () => {
        const value = email.value.trim();
        if (!value) setError("error-emailAddress", "Email is required.");
        else if (!value.includes("@") || !value.includes(".")) setError("error-emailAddress", "Invalid email format.");
        else clearError("error-emailAddress");
    });

    phone.addEventListener("input", () => {
        const value = phone.value.trim();
        if (!value) setError("error-telephoneNumber", "Telephone number is required.");
        else if (!/^[0-9 +()-]+$/.test(value)) setError("error-telephoneNumber", "Invalid phone number.");
        else clearError("error-telephoneNumber");
    });

    issueType.addEventListener("change", () => {
        issueType.value
            ? clearError("error-issueType")
            : setError("error-issueType", "Please select an issue type.");
    });

    evidenceFile.addEventListener("change", () => {
        const file = evidenceFile.files[0];
        if (!file) {
            clearError("error-evidenceFile");
            return;
        }

        const allowedTypes = ["image/jpeg", "image/png", "image/jpg", "application/pdf"];
        if (!allowedTypes.includes(file.type)) {
            setError("error-evidenceFile", "Only JPG, PNG, or PDF files are allowed.");
            evidenceFile.value = "";
            return;
        }

        if (file.size > 5 * 1024 * 1024) {
            setError("error-evidenceFile", "File size must be under 5MB.");
            evidenceFile.value = "";
            return;
        }

        clearError("error-evidenceFile");
    });

    message.addEventListener("input", () => {
        message.value.trim()
            ? clearError("error-message")
            : setError("error-message", "Message cannot be empty.");
    });

    // SUBMIT VALIDATION
    form.addEventListener("submit", function (event) {
        let hasError = false;

        if (!firstName.value.trim()) { setError("error-firstName", "First name is required."); hasError = true; }
        if (!lastName.value.trim()) { setError("error-lastName", "Last name is required."); hasError = true; }

        const emailValue = email.value.trim();
        if (!emailValue) { setError("error-emailAddress", "Email is required."); hasError = true; }
        else if (!emailValue.includes("@") || !emailValue.includes(".")) {
            setError("error-emailAddress", "Invalid email format."); hasError = true;
        }

        const phoneValue = phone.value.trim();
        if (!phoneValue) { setError("error-telephoneNumber", "Telephone number is required."); hasError = true; }
        else if (!/^[0-9 +()-]+$/.test(phoneValue)) {
            setError("error-telephoneNumber", "Invalid phone number."); hasError = true;
        }

        if (!issueType.value) { setError("error-issueType", "Please select an issue type."); hasError = true; }
        if (!message.value.trim()) { setError("error-message", "Message cannot be empty."); hasError = true; }

        const file = evidenceFile.files[0];
        if (file) {
            const allowedTypes = ["image/jpeg", "image/png", "image/jpg", "application/pdf"];
            if (!allowedTypes.includes(file.type)) {
                setError("error-evidenceFile", "Only JPG, PNG, or PDF files are allowed.");
                hasError = true;
            }
            if (file.size > 5 * 1024 * 1024) {
                setError("error-evidenceFile", "File size must be under 5MB.");
                hasError = true;
            }
        }

        if (hasError) event.preventDefault();
    });

});
</script>
{% endblock extra_js %}
